"""한국 대기업집단(계열사) 탐지 모듈.

종목명을 기반으로 소속 기업집단을 판별한다.
정적 매핑(접두사가 다른 핵심 종목) + 접두사 매칭 + 블랙리스트 하이브리드 방식.

데이터 기준: 공정거래위원회 대규모기업집단 지정 (2024~2025)
"""

from typing import Optional


# ===================================================================
# 정적 매핑: 접두사로 판별 불가능한 핵심 계열사
# ===================================================================

# {종목명: 그룹명}
_STATIC_MAP: dict[str, str] = {
    # 삼성 — 접두사 '삼성'이 아닌 계열사
    "호텔신라": "삼성",
    "에스원": "삼성",
    "멀티캠퍼스": "삼성",
    "제일기획": "삼성",
    # 현대차 — 접두사 '현대'가 아닌 계열사
    "기아": "현대차",
    "이노션": "현대차",
    # SK — 접두사 'SK'가 아닌 계열사
    "나노엔텍": "SK",
    # LG — 접두사 'LG'가 아닌 계열사
    "지투알": "LG",
    # HD현대(구 현대중공업) — '현대차'와 별도 그룹
    "한국조선해양": "HD현대",
    # 신세계 — 접두사 '신세계'가 아닌 계열사
    "이마트": "신세계",
    "스타벅스코리아": "신세계",
    # 한진 — 접두사 '한진'이 아닌 계열사
    "대한항공": "한진",
    "진에어": "한진",
    # 카카오 — 접두사 '카카오'가 아닌 계열사
    "카카오뱅크": "카카오",
    # 네이버 — 접두사 '네이버'가 아닌 계열사
    "라인플러스": "네이버",
}


# ===================================================================
# 접두사 매칭 대상 그룹 (가장 일반적인 대기업집단)
# ===================================================================

_PREFIX_GROUPS: list[tuple[str, str]] = [
    # (접두사, 그룹명) — 길이 내림차순 정렬 (긴 접두사 우선)
    ("HD현대", "HD현대"),
    ("현대백화점", "현대백화점"),
    ("삼성", "삼성"),
    ("SK", "SK"),
    ("LG", "LG"),
    ("현대", "현대차"),
    ("롯데", "롯데"),
    ("한화", "한화"),
    ("포스코", "포스코"),
    ("GS", "GS"),
    ("CJ", "CJ"),
    ("두산", "두산"),
    ("신세계", "신세계"),
    ("한진", "한진"),
    ("카카오", "카카오"),
    ("네이버", "네이버"),
    ("KT", "KT"),
]


# ===================================================================
# 블랙리스트: 접두사가 일치하지만 해당 그룹이 아닌 종목
# ===================================================================

_BLACKLIST: set[str] = {
    # '삼성' 접두사이지만 삼성그룹 아님
    "삼성공조",
    "삼성출판사",
    # '현대' 접두사이지만 현대차그룹 아님 (별도 그룹 or 무관)
    "현대공업",
    "현대통신",
    # 'SK' 접두사이지만 SK그룹 아님
    "SKC솔믹스",
}


def detect_conglomerate(name: str) -> Optional[str]:
    """종목명으로 소속 기업집단을 판별한다.

    판별 순서:
    1. 정적 매핑 (접두사로 잡히지 않는 핵심 종목)
    2. 블랙리스트 확인 (접두사 일치하지만 비계열사)
    3. 접두사 매칭 (긴 접두사 우선)

    Args:
        name: 종목명 (예: '삼성전자', '기아', '삼성공조')

    Returns:
        그룹명 문자열 (예: '삼성', '현대차') 또는 None (판별 불가).
    """
    if not name:
        return None

    # 1. 정적 매핑
    if name in _STATIC_MAP:
        return _STATIC_MAP[name]

    # 2. 블랙리스트
    if name in _BLACKLIST:
        return None

    # 3. 접두사 매칭 (긴 접두사 우선으로 정렬됨)
    for prefix, group in _PREFIX_GROUPS:
        if name.startswith(prefix):
            return group

    return None
